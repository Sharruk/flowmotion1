{% extends 'base.html' %}

{% block title %}Login - FlowMotion{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-card">
        <h1>Welcome to FlowMotion</h1>
        <p class="subtitle">Your intelligent habit tracking companion</p>
        
        <form method="post" class="auth-form">
            {% csrf_token %}
            <div class="form-group">
                <label for="id_username">Username</label>
                <input type="text" name="username" id="id_username" required>
            </div>
            <div class="form-group">
                <label for="id_password">Password</label>
                <input type="password" name="password" id="id_password" required>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="tc_checkbox" class="tc-checkbox" required>
                <label for="tc_checkbox" class="tc-label">I agree to the <a href="#" id="tc_link">Terms and Conditions</a></label>
            </div>

            <button type="submit" id="login_btn" class="btn btn-primary" disabled title="Please accept Terms and Conditions to login">Login</button>
        </form>
        
        <p class="auth-link">Don't have an account? <a href="{% url 'register' %}">Register</a></p>
    </div>
</div>

<!-- Terms and Conditions Modal -->
<div id="tc_modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Terms and Conditions</h2>
            <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body" id="tc_body">
            <h3>1. Data Privacy</h3>
            <p>FlowMotion is an academic prototype. Your data is stored locally for tracking purposes and is not shared with third parties.</p>
            
            <h3>2. Usage</h3>
            <p>This system is intended for personal habit tracking. Users are responsible for their own data entry and routine management.</p>
            
            <h3>3. No Liability</h3>
            <p>The developers of FlowMotion provide this tool "as is" and are not liable for any missed habits, routines, or productivity outcomes.</p>
            
            <h3>4. Linux Environment</h3>
            <p>This application is designed specifically for Linux desktop environments using native notification services.</p>
            
            <h3>5. User Conduct</h3>
            <p>Users shall not attempt to reverse engineer the scheduling system or interfere with background processes.</p>
            
            <h3>6. Academic Use</h3>
            <p>This project is for educational purposes only. It is not intended for commercial use.</p>
        </div>
        <div class="modal-footer">
            <button id="modal_accept_btn" class="btn btn-primary" disabled>Accept & Continue</button>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const checkbox = document.getElementById('tc_checkbox');
        const loginBtn = document.getElementById('login_btn');
        const usernameInput = document.getElementById('id_username');
        const passwordInput = document.getElementById('id_password');
        const tcLink = document.getElementById('tc_link');
        const modal = document.getElementById('tc_modal');
        const tcBody = document.getElementById('tc_body');
        const closeModal = document.querySelector('.close-modal');
        const modalAccept = document.getElementById('modal_accept_btn');

        function validateForm() {
            const isUsernameFilled = usernameInput.value.trim() !== '';
            const isPasswordFilled = passwordInput.value.trim() !== '';
            const isCheckboxChecked = checkbox.checked;
            loginBtn.disabled = !(isUsernameFilled && isPasswordFilled && isCheckboxChecked);
            
            if (loginBtn.disabled) {
                loginBtn.title = "Please fill all fields and accept Terms and Conditions";
            } else {
                loginBtn.title = "";
            }
        }

        usernameInput.addEventListener('input', validateForm);
        passwordInput.addEventListener('input', validateForm);
        checkbox.addEventListener('change', validateForm);

        // Show modal
        tcLink.addEventListener('click', function(e) {
            e.preventDefault();
            modal.style.display = 'block';
            tcBody.scrollTop = 0;
            modalAccept.disabled = true;
            modalAccept.title = "Please scroll to the bottom to accept";
        });

        // Scroll logic with tolerance
        tcBody.addEventListener('scroll', function() {
            const tolerance = 5;
            const isAtBottom = tcBody.scrollHeight - tcBody.scrollTop <= tcBody.clientHeight + tolerance;
            if (isAtBottom) {
                modalAccept.disabled = false;
                modalAccept.title = "Click to accept and close";
            }
        });

        // Modal Acceptance
        modalAccept.onclick = function() {
            checkbox.checked = true;
            modal.style.display = 'none';
            validateForm();
        };

        // Hide modal
        closeModal.onclick = () => modal.style.display = 'none';
        
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        };
    });
</script>
{% endblock %}
